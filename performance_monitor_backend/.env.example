# --- MongoDB connection (backend storage: perfmon DB) ---
# Preferred (Kavia multi-container): backend auto-reads mongodb_instance/db_connection.txt when present.
# This resolves the internal mongod port correctly even if Preview exposes a different external port.
#
# Fallback: set BACKEND_MONGO_URI explicitly.
BACKEND_MONGO_URI=mongodb://localhost:27017

# Diagnostics / docs:
# - GET /api/health/mongo returns which URI source/path was used, and whether ping succeeded.

# --- Backend <-> Frontend integration ---
# Standardized frontend origin for CORS.
# (Legacy: REACT_APP_FRONTEND_URL is still supported.)
FRONTEND_URL=http://localhost:3000
REACT_APP_FRONTEND_URL=http://localhost:3000

# Optional: additional allowed origins (comma-separated), e.g. preview URL(s)
# CORS_ALLOW_ORIGINS=https://<your-preview-host>
CORS_ALLOW_ORIGINS=

# --- Metrics sampler ---
METRICS_SAMPLING_INTERVAL_SEC=5
METRICS_RETENTION_DAYS=7

# --- Metrics storage optimization (TTL + rollups) ---
# TTL index for raw samples in perfmon.metrics_samples on field `ts` (Date).
# 0 disables TTL (not recommended for production).
# Range clamped to [60, 31536000] when non-zero.
METRICS_RAW_TTL_SECONDS=604800

# Enable background compaction/rollups into perfmon.metrics_rollups.
METRICS_ROLLUP_ENABLED=false

# Rollup bucket size (seconds). Typical: 60 (1m) or 300 (5m). Range clamped to [10, 3600].
METRICS_ROLLUP_BUCKET_SECONDS=60

# TTL index for rollups in perfmon.metrics_rollups on field `bucket` (Date). 0 disables TTL.
METRICS_ROLLUP_TTL_SECONDS=2592000

# How often the rollup job runs (seconds). Range clamped to [5, 3600].
METRICS_ROLLUP_COMPACTION_INTERVAL_SEC=30

# When a timeseries request spans >= this many seconds, the backend will prefer rollups (if enabled),
# otherwise it reads raw samples. Range clamped to [60, 31536000].
METRICS_ROLLUP_QUERY_THRESHOLD_SECONDS=21600

# --- Alerts engine ---
# How often to evaluate alert rules against stored samples.
ALERT_EVAL_INTERVAL_SEC=5
# Minimum seconds between state-change events per (ruleId, instanceId) to reduce noise.
ALERT_EVENT_COOLDOWN_SEC=60

# --- Recommendations engine tuning ---
RECS_DEFAULT_TTL_DAYS=14
RECS_MAX_RETURN=50
