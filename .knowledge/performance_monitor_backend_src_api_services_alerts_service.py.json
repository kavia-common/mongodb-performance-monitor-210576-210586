{"is_source_file": true, "format": "Python", "description": "This is a Python source file defining service functions for managing alert rules and events in a monitoring system. It includes functions for creating, retrieving, updating, deleting, and listing alert rules, as well as listing alert events with filtering. The file interacts with a MongoDB backend via a state management system and schemas for data validation and serialization.", "external_files": ["bson.ObjectId", "fastapi.Request", "src.api.schemas.alerts", "src.api.schemas.common", "src.api.state"], "external_methods": ["ObjectId", "Request", "AlertEventOut", "AlertEventsQuery", "AlertRuleCreate", "AlertRuleOut", "AlertRuleUpdate", "utc_now", "get_state"], "published": ["init_alerts_indexes", "list_rules", "create_rule", "get_rule", "put_rule", "patch_rule", "delete_rule", "list_events"], "classes": [], "methods": [{"name": "str _oid_str(v: Any)", "description": "Converts a value to string, returns empty string on failure.", "scope": "", "scopeKind": ""}, {"name": "AlertRuleOut _doc_to_rule_out(doc: dict)", "description": "Converts a MongoDB document to an AlertRuleOut schema object.", "scope": "", "scopeKind": ""}, {"name": "AlertEventOut _doc_to_event_out(doc: dict)", "description": "Converts a MongoDB document to an AlertEventOut schema object.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _build_rules_query(instance_id: Optional[str])", "description": "Builds a MongoDB query for alert rules filtered by instance ID, supporting global and instance-specific rules.", "scope": "", "scopeKind": ""}, {"name": "None init_alerts_indexes(request: Request)", "description": "Ensures MongoDB indexes for alerts collections exist.", "scope": "", "scopeKind": ""}, {"name": "List[AlertRuleOut] list_rules(request: Request, instance_id: Optional[str] = None)", "description": "Retrieves a list of alert rules, optionally filtered by instance ID.", "scope": "", "scopeKind": ""}, {"name": "AlertRuleOut create_rule(request: Request, payload: AlertRuleCreate)", "description": "Creates a new alert rule in the database with provided payload.", "scope": "", "scopeKind": ""}, {"name": "Optional[AlertRuleOut] get_rule(request: Request, rule_id: str)", "description": "Fetches a single alert rule by its ID.", "scope": "", "scopeKind": ""}, {"name": "dict _apply_rule_update(existing: dict, payload: AlertRuleUpdate)", "description": "Applies partial updates to an existing alert rule document based on a provided update payload.", "scope": "", "scopeKind": ""}, {"name": "Optional[AlertRuleOut] put_rule(request: Request, rule_id: str, payload: AlertRuleCreate)", "description": "Replaces an existing alert rule completely with new data.", "scope": "", "scopeKind": ""}, {"name": "Optional[AlertRuleOut] patch_rule(request: Request, rule_id: str, payload: AlertRuleUpdate)", "description": "Partially updates an existing alert rule.", "scope": "", "scopeKind": ""}, {"name": "bool delete_rule(request: Request, rule_id: str)", "description": "Deletes an alert rule by ID.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _events_query_from_filters(q: AlertEventsQuery)", "description": "Constructs a MongoDB query from alert event filter parameters.", "scope": "", "scopeKind": ""}, {"name": "Tuple[List[AlertEventOut],int] list_events(request: Request, filters: AlertEventsQuery)", "description": "Lists alert events with filtering, sorting, and pagination support.", "scope": "", "scopeKind": ""}], "calls": ["get_state(request.app)", "utc_now()", "ObjectId(rule_id)", "cols.alert_rules.find()", "cols.alert_rules.insert_one()", "cols.alert_rules.find_one()", "cols.alert_rules.replace_one()", "cols.alert_rules.delete_one()", "cols.alert_events.count_documents()", "cols.alert_events.find()"], "search-terms": ["alerts", "alert rules", "alert events", "MongoDB", "rules CRUD", "event listing", "indexes"], "state": 2, "file_id": 27, "knowledge_revision": 76, "git_revision": "9e7446029497066b1021343648c0face5bcaa592", "ctags": [{"_type": "tag", "name": "_apply_rule_update", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _apply_rule_update(existing: dict, payload: AlertRuleUpdate) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(existing: dict, payload: AlertRuleUpdate)"}, {"_type": "tag", "name": "_build_rules_query", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _build_rules_query(instance_id: Optional[str]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(instance_id: Optional[str])"}, {"_type": "tag", "name": "_doc_to_event_out", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _doc_to_event_out(doc: dict) -> AlertEventOut:$/", "language": "Python", "typeref": "typename:AlertEventOut", "kind": "function", "signature": "(doc: dict)"}, {"_type": "tag", "name": "_doc_to_rule_out", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _doc_to_rule_out(doc: dict) -> AlertRuleOut:$/", "language": "Python", "typeref": "typename:AlertRuleOut", "kind": "function", "signature": "(doc: dict)"}, {"_type": "tag", "name": "_events_query_from_filters", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _events_query_from_filters(q: AlertEventsQuery) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(q: AlertEventsQuery)"}, {"_type": "tag", "name": "_oid_str", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def _oid_str(v: Any) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "create_rule", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def create_rule(request: Request, payload: AlertRuleCreate) -> AlertRuleOut:$/", "language": "Python", "typeref": "typename:AlertRuleOut", "kind": "function", "signature": "(request: Request, payload: AlertRuleCreate)"}, {"_type": "tag", "name": "delete_rule", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def delete_rule(request: Request, rule_id: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(request: Request, rule_id: str)"}, {"_type": "tag", "name": "get_rule", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def get_rule(request: Request, rule_id: str) -> Optional[AlertRuleOut]:$/", "language": "Python", "typeref": "typename:Optional[AlertRuleOut]", "kind": "function", "signature": "(request: Request, rule_id: str)"}, {"_type": "tag", "name": "init_alerts_indexes", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def init_alerts_indexes(request: Request) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "list_events", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def list_events(request: Request, filters: AlertEventsQuery) -> Tuple[List[AlertEventOut], int]:$/", "language": "Python", "typeref": "typename:Tuple[List[AlertEventOut],int]", "kind": "function", "signature": "(request: Request, filters: AlertEventsQuery)"}, {"_type": "tag", "name": "list_rules", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def list_rules(request: Request, instance_id: Optional[str] = None) -> List[AlertRuleOut]:$/", "language": "Python", "typeref": "typename:List[AlertRuleOut]", "kind": "function", "signature": "(request: Request, instance_id: Optional[str] = None)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "patch_rule", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def patch_rule(request: Request, rule_id: str, payload: AlertRuleUpdate) -> Optional[AlertRuleOu/", "language": "Python", "typeref": "typename:Optional[AlertRuleOut]", "kind": "function", "signature": "(request: Request, rule_id: str, payload: AlertRuleUpdate)"}, {"_type": "tag", "name": "put_rule", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/services/alerts_service.py", "pattern": "/^def put_rule(request: Request, rule_id: str, payload: AlertRuleCreate) -> Optional[AlertRuleOut]/", "language": "Python", "typeref": "typename:Optional[AlertRuleOut]", "kind": "function", "signature": "(request: Request, rule_id: str, payload: AlertRuleCreate)"}], "hash": "de08b8dc80a6e9aead734f758ff5ec0e", "format-version": 4, "code-base-name": "performance_monitor_backend", "filename": "performance_monitor_backend/src/api/services/alerts_service.py", "fields": [{"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"76": "9e7446029497066b1021343648c0face5bcaa592"}]}