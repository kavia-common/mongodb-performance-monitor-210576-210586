{"is_source_file": true, "format": "Python", "description": "Main entry point for the FastAPI backend API of the MongoDB Performance Monitor application. It initializes the app, configures middleware, sets up startup and shutdown event handlers, and includes routers for various API endpoints related to health, instances, metrics, alerts, and recommendations.", "external_files": ["src.api.config", "src.api.routers", "src.api.services.alerts_evaluator", "src.api.services.metrics_rollup", "src.api.services.metrics_sampler", "src.api.state"], "external_methods": ["load_config", "alerts_evaluator_loop", "rollup_loop", "sampler_loop", "get_state", "init_state"], "published": ["app"], "classes": [], "methods": [{"name": "None _on_startup()", "description": "Handles application startup: connects to MongoDB, verifies connectivity, initializes indexes, and starts background background tasks for sampling, alerts evaluation, and rollups.", "scope": "", "scopeKind": ""}, {"name": "None _on_shutdown()", "description": "Handles application shutdown: stops background tasks and closes MongoDB connections.", "scope": "", "scopeKind": ""}, {"name": "str|None _env_frontend_url()", "description": "Retrieves the frontend URL from environment variables, supporting multiple variable names for legacy compatibility.", "scope": "", "scopeKind": ""}, {"name": "List[str] _env_cors_extra_origins()", "description": "Parses additional CORS allowed origins from environment variables.", "scope": "", "scopeKind": ""}], "calls": ["FastAPI", "CORSMiddleware", "load_config", "alerts_evaluator_loop", "rollup_loop", "sampler_loop", "get_state", "init_state", "app.include_router", "app.add_middleware", "os.getenv", "asyncio.create_task", "asyncio.Event", "asyncio.wait_for", "state.mongo.connect_app", "state.mongo.ping", "state.mongo.init_indexes", "state.mongo.close"], "search-terms": ["MongoDB Performance Monitor", "FastAPI startup shutdown", "background tasks", "MongoDB connection management", "api router inclusion", "CORS configuration"], "state": 2, "file_id": 2, "knowledge_revision": 85, "git_revision": "d74cfd9e45156ce797a4585d816d9a2c1367cabf", "revision_history": [{"9": "f42301804fe08ae5ee7c6452b872458071970ce0"}, {"27": "5c1110a3ebc62d3d78963eacede0143bf7676821"}, {"53": "ac108bb99020dc67cfe8a133c3fe05fd9ce788f5"}, {"74": "9e7446029497066b1021343648c0face5bcaa592"}, {"80": "09410bea15e21a7e3c9b73c6e17854e1898bd9de"}, {"85": "d74cfd9e45156ce797a4585d816d9a2c1367cabf"}], "ctags": [{"_type": "tag", "name": "_env_cors_extra_origins", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^def _env_cors_extra_origins() -> List[str]:$/", "language": "Python", "typeref": "typename:List[str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_env_frontend_url", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^def _env_frontend_url() -> str | None:$/", "language": "Python", "typeref": "typename:str|None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_on_shutdown", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^async def _on_shutdown() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_on_startup", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^async def _on_startup() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_seen", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^_seen = set()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "allowed_origins", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^allowed_origins = [o for o in allowed_origins if not (o in _seen or _seen.add(o))]$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "allowed_origins", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^allowed_origins: List[str] = [\"http:\\/\\/localhost:3000\", \"http:\\/\\/127.0.0.1:3000\"]$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "frontend_url", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^frontend_url = _env_frontend_url()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}], "hash": "61a71bb74ecd9c9136bf89b4b2291bd8", "format-version": 4, "code-base-name": "performance_monitor_backend", "filename": "performance_monitor_backend/src/api/main.py", "fields": [{"name": "_seen = set()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "allowed_origins = [o for o in allowed_origins if not (o in _seen or _seen.add(o))]", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] allowed_origins", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "frontend_url = _env_frontend_url()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}]}