{"is_source_file": true, "format": "Python", "description": "This file provides a MongoDB connection management layer for a performance monitoring backend. It defines data structures for app collections, manages MongoDB client connections, provides methods for connectivity checks, index initialization, and handling multiple target instances.", "external_files": ["pymongo", "pymongo.collection", "pymongo.database", "pymongo.errors"], "external_methods": ["pymongo.MongoClient", "pymongo.collection.Collection", "pymongo.database.Database", "pymongo.errors.PyMongoError"], "published": ["MongoCollections", "MongoManager"], "classes": [{"name": "MongoCollections", "description": "A dataclass wrapping references to the main app MongoDB collections symbolizing different data entities used by the application."}, {"name": "MongoManager", "description": "A class managing MongoDB connections, including the primary app database and monitored target instances, with methods for connecting, pinging, closing, indexing setup, and client retrieval for target instances."}], "methods": [{"name": "None connect_app(self)", "description": "Initializes the application's MongoDB client if not already connected.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "bool ping(self, timeout_ms: int = 1500)", "description": "Performs a connectivity check to the MongoDB server, returning True if successful.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "None close(self)", "description": "Closes all active MongoDB client connections, including app and target clients.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "Database app_db(self)", "description": "Returns a handle to the application database 'perfmon'.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "MongoCollections collections(self)", "description": "Provides access to the main application collections wrapped in a MongoCollections dataclass.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "None init_indexes(self, *, raw_ttl_seconds: int = 0, rollup_ttl_seconds: int = 0)", "description": "Creates necessary MongoDB indexes for collections, with optional TTL indexes based on provided seconds.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "MongoClient target_client(self, instance_id: str, uri: str)", "description": "Retrieves or creates a cached MongoClient for a monitored target instance, identified by instance_id and connection URI.", "scope": "MongoManager", "scopeKind": "class"}, {"name": "__init__(self, app_mongo_uri: str)", "scope": "MongoManager", "scopeKind": "class", "description": "unavailable"}], "calls": ["self.connect_app()", "self._app_client.admin.command", "self._app_client.close()", "client.close()", "db[collection_name]", "collection.create_index"], "search-terms": ["MongoManager", "MongoCollections", "target_client", "indexes", "performance_monitor"], "state": 2, "file_id": 22, "knowledge_revision": 83, "git_revision": "d74cfd9e45156ce797a4585d816d9a2c1367cabf", "revision_history": [{"55": "ac108bb99020dc67cfe8a133c3fe05fd9ce788f5"}, {"59": "d21f925c1fc950dcc3050ff0205bcb57f4237af9"}, {"66": "9e7446029497066b1021343648c0face5bcaa592"}, {"79": "09410bea15e21a7e3c9b73c6e17854e1898bd9de"}, {"83": "d74cfd9e45156ce797a4585d816d9a2c1367cabf"}], "ctags": [{"_type": "tag", "name": "APP_DB_NAME", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^APP_DB_NAME = \"perfmon\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "MongoCollections", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^class MongoCollections:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MongoManager", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^class MongoManager:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def __init__(self, app_mongo_uri: str):$/", "language": "Python", "kind": "member", "signature": "(self, app_mongo_uri: str)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "app_db", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def app_db(self) -> Database:$/", "language": "Python", "typeref": "typename:Database", "kind": "member", "signature": "(self)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "close", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def close(self) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "collections", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def collections(self) -> MongoCollections:$/", "language": "Python", "typeref": "typename:MongoCollections", "kind": "member", "signature": "(self)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "connect_app", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def connect_app(self) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "init_indexes", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def init_indexes(self, *, raw_ttl_seconds: int = 0, rollup_ttl_seconds: int = 0) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, *, raw_ttl_seconds: int = 0, rollup_ttl_seconds: int = 0)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ping", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def ping(self, timeout_ms: int = 1500) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "member", "signature": "(self, timeout_ms: int = 1500)", "scope": "MongoManager", "scopeKind": "class"}, {"_type": "tag", "name": "target_client", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/db/mongo.py", "pattern": "/^    def target_client(self, instance_id: str, uri: str) -> MongoClient:$/", "language": "Python", "typeref": "typename:MongoClient", "kind": "member", "signature": "(self, instance_id: str, uri: str)", "scope": "MongoManager", "scopeKind": "class"}], "hash": "691c96d6be1d778045f0bf287b373daa", "format-version": 4, "code-base-name": "performance_monitor_backend", "filename": "performance_monitor_backend/src/api/db/mongo.py", "fields": [{"name": "APP_DB_NAME = \"perfmon\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}]}