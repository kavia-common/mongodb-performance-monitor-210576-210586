{"is_source_file": true, "format": "Python", "description": "This file defines API router endpoints for health checks related to the backend system, including service liveness, MongoDB connectivity diagnostics, and metrics storage configuration diagnostics. It utilizes FastAPI, Pydantic, and request handling to expose diagnostic data.", "external_files": ["src.api.schemas.common", "src.api.state"], "external_methods": ["src.api.schemas.common.HealthResponse", "src.api.schemas.common.utc_now", "src.api.state.get_state"], "published": ["health_check", "mongo_connectivity_check", "metrics_storage_diagnostics"], "classes": [{"name": "MongoConnectivityResponse", "description": "Response model representing connectivity diagnostics and URI info for MongoDB."}, {"name": "MetricsStorageDiagnosticsResponse", "description": "Response model reporting the TTL and rollup configuration for metrics storage diagnostics."}], "methods": [{"name": "HealthResponse health_check()", "description": "Performs a basic liveness check of the service, returning status 'ok' with timestamp.", "scope": "", "scopeKind": ""}, {"name": "MongoConnectivityResponse mongo_connectivity_check(request: Request)", "description": "Endpoint to ping MongoDB, returning sanitized URI info, status, and timestamp.", "scope": "", "scopeKind": ""}, {"name": "MetricsStorageDiagnosticsResponse metrics_storage_diagnostics(request: Request)", "description": "Provides diagnostics related to metrics TTL and rollup configuration.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_mongo_uri_for_response(uri: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_state", "utc_now", "state.mongo.ping"], "search-terms": ["MongoDB connectivity", "metrics storage diagnostics", "health check", "URI sanitization", "APIRouter"], "state": 2, "file_id": 13, "knowledge_revision": 88, "git_revision": "d74cfd9e45156ce797a4585d816d9a2c1367cabf", "revision_history": [{"35": "5c1110a3ebc62d3d78963eacede0143bf7676821"}, {"81": "09410bea15e21a7e3c9b73c6e17854e1898bd9de"}, {"88": "d74cfd9e45156ce797a4585d816d9a2c1367cabf"}], "ctags": [{"_type": "tag", "name": "MetricsStorageDiagnosticsResponse", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^class MetricsStorageDiagnosticsResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MongoConnectivityResponse", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^class MongoConnectivityResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_sanitize_mongo_uri_for_response", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^def _sanitize_mongo_uri_for_response(uri: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(uri: str)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^def health_check() -> HealthResponse:$/", "language": "Python", "typeref": "typename:HealthResponse", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "meta", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    meta: Dict[str, Any] = Field(default_factory=dict, description=\"Optional debug metadata.\")$/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "MongoConnectivityResponse", "scopeKind": "class"}, {"_type": "tag", "name": "metrics_storage_diagnostics", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^def metrics_storage_diagnostics(request: Request) -> MetricsStorageDiagnosticsResponse:$/", "language": "Python", "typeref": "typename:MetricsStorageDiagnosticsResponse", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "mongo_connectivity_check", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^def mongo_connectivity_check(request: Request) -> MongoConnectivityResponse:$/", "language": "Python", "typeref": "typename:MongoConnectivityResponse", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "mongo_uri_sanitized", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    mongo_uri_sanitized: str = Field(..., description=\"MongoDB URI with credentials masked.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "MongoConnectivityResponse", "scopeKind": "class"}, {"_type": "tag", "name": "mongo_uri_source", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    mongo_uri_source: str = Field(..., description=\"Which source provided the effective MongoDB /", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "MongoConnectivityResponse", "scopeKind": "class"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    ok: bool = Field(..., description=\"Whether the backend can successfully ping MongoDB.\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "MongoConnectivityResponse", "scopeKind": "class"}, {"_type": "tag", "name": "raw_ttl_seconds", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    raw_ttl_seconds: int = Field(..., description=\"TTL (seconds) applied to raw metrics_samples /", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "rollup_bucket_seconds", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    rollup_bucket_seconds: int = Field(..., description=\"Rollup bucket size (seconds).\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "rollup_compaction_interval_sec", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    rollup_compaction_interval_sec: int = Field(..., description=\"How often the rollup job runs /", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "rollup_enabled", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    rollup_enabled: bool = Field(..., description=\"Whether background rollup\\/compaction is enab/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "rollup_query_threshold_seconds", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    rollup_query_threshold_seconds: int = Field($/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "rollup_ttl_seconds", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    rollup_ttl_seconds: int = Field(..., description=\"TTL (seconds) applied to metrics_rollups (/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^router = APIRouter(tags=[\"Health\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "timestamp", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    timestamp: str = Field(..., description=\"UTC timestamp when the check was performed (ISO str/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "MongoConnectivityResponse", "scopeKind": "class"}, {"_type": "tag", "name": "timestamp", "path": "/home/kavia/workspace/code-generation/mongodb-performance-monitor-210576-210586/performance_monitor_backend/src/api/routers/health.py", "pattern": "/^    timestamp: str = Field(..., description=\"UTC timestamp when the diagnostics were produced (I/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class"}], "hash": "86c9cbdada364f54b1cd7b8324042aca", "format-version": 4, "code-base-name": "performance_monitor_backend", "filename": "performance_monitor_backend/src/api/routers/health.py", "fields": [{"name": "Dict[str, Any] meta", "scope": "MongoConnectivityResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str mongo_uri_sanitized", "scope": "MongoConnectivityResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str mongo_uri_source", "scope": "MongoConnectivityResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool ok", "scope": "MongoConnectivityResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int raw_ttl_seconds", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int rollup_bucket_seconds", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int rollup_compaction_interval_sec", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool rollup_enabled", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int rollup_query_threshold_seconds", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int rollup_ttl_seconds", "scope": "MetricsStorageDiagnosticsResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Health\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str timestamp", "scope": "MongoConnectivityResponse", "scopeKind": "class", "description": "unavailable"}]}